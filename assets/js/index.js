let popular = {
  data:[
    {
      nombre: "La MR. Pit",
      category: "Pizza",
      descripcion: "Sólo para expertos",
      precio: "$350",
      imagen: "./assets/img/Photo Menu.png",
    },
    {
      nombre: "¡Q'Jamone!",
      category: "Pizza",
      descripcion: "c/jamón crudo",
      precio: "$350",
      imagen: "./assets/img/Photo Menu-1.png",
    },
    {
      nombre: "La Charly García",
      category: "Pizza",
      descripcion: "¡BASTA!",
      precio: "$380",
      imagen: "./assets/img/Photo Menu-2.png",
    },
    {
      nombre: "La Maradona",
      category: "Pizza",
      descripcion: "¡Eterna!",
      precio: "$450",
      imagen: "./assets/img/Photo Menu-3.png",
    },
    {
      nombre: "Picantovich",
      category: "Pizza",
      descripcion: "Pica 2 veces",
      precio: "$750",
      imagen: "./assets/img/Photo Menu-4.png",
    },
    {
      nombre: "La Hasbulla",
      category: "Pizza",
      descripcion: "En honor al 1",
      precio: "$990",
      imagen: "./assets/img/Photo Menu-5.png",
    },
    {
      nombre: "Leo Messi",
      category: "Pizza",
      descripcion: "¡De pie señores!",
      precio: "$10",
      imagen: "./assets/img/Photo Menu-6.png",
    },
    {
      nombre: "Nick Gi",
      category: "Pizza",
      descripcion: "La que desaparece",
      precio: "$Gratis",
      imagen: "./assets/img/Photo Menu-7.png",
    },
  ]
};

let products = {
  data:[
    {
      id: 1,
      nombre: "La MR. Pit",
      category: "Pizzas",
      descripcion: "Sólo para expertos",
      precio: "$350",
      imagen: "./assets/img/Photo Menu.png",
    },
    {
      id: 2,
      nombre: "¡Q'Jamone!",
      category: "Pizzas",
      descripcion: "c/jamón crudo",
      precio: "$350",
      imagen: "./assets/img/Photo Menu-1.png",
    },
    {
      id: 3,
      nombre: "La Charly García",
      category: "Pizzas",
      descripcion: "¡BASTA!",
      precio: "$380",
      imagen: "./assets/img/Photo Menu-2.png",
    },
    {
      id: 4,
      nombre: "La Maradona",
      category: "Pizzas",
      descripcion: "¡Eterna!",
      precio: "$10",
      imagen: "./assets/img/Photo Menu-3.png",
    },
    {
      id: 5,
      nombre: "Picantovich",
      category: "Pizzas",
      descripcion: "Pica 2 veces",
      precio: "$750",
      imagen: "./assets/img/Photo Menu-4.png",
    },
    {
      id: 6,
      nombre: "La Hasbulla",
      category: "Pizzas",
      descripcion: "En honor al 1",
      precio: "$990",
      imagen: "./assets/img/Photo Menu-5.png",
    },
    {
      id: 7,
      nombre: "Leo Messi",
      category: "Pizzas",
      descripcion: "¡De pie señores!",
      precio: "$350",
      imagen: "./assets/img/Photo Menu-6.png",
    },
    {
      id: 8,
      nombre: "Nick Gi",
      category: "Pizzas",
      descripcion: "La que desaparece",
      precio: "$Gratis",
      imagen: "./assets/img/Photo Menu-7.png",
    },
    {
      id: 9,
      nombre: "Bennazianna",
      category: "Pizzas",
      descripcion: "La más completa",
      precio: "$3650",
      imagen: "./assets/img/pizza_bennaziana.jpg",
    },
    {
      id: 10,
      nombre: "Tronco-Pizza",
      category: "Pizzas",
      descripcion: "Para todo el día",
      precio: "$870",
      imagen: "./assets/img/pizza_tronco.jpg",
    },
    {
      id: 11,
      nombre: "Clásica",
      category: "Hamburguesas",
      descripcion: "La que nunca defrauda",
      precio: "$450",
      imagen: "./assets/img/hambur_clasica.jpg",
    },
    {
      id: 12,
      nombre: "Shack burger de queso",
      category: "Hamburguesas",
      descripcion: "Puro queso",
      precio: "$550",
      imagen: "./assets/img/hambur_queso.jpg",
    },
    {
      id: 13,
      nombre: "Ranchera",
      category: "Hamburguesas",
      descripcion: "Tapa arterias",
      precio: "$600",
      imagen: "./assets/img/hambur_ranchera.jpg",
    },
    {
      id: 14,
      nombre: "Vegetariana",
      category: "Hamburguesas",
      descripcion: "La vaca te agradece",
      precio: "$400",
      imagen: "./assets/img/hambur_vegetariana.jpg",
    },
    {
      id: 15,
      nombre: "Papas Provenzal",
      category: "Napapuki",
      descripcion: "Van como piña",
      precio: "$360",
      imagen: "./assets/img/papas_provenzal.jpg",
    },
    {
      id: 16,
      nombre: "Papas Dulces",
      category: "Napapuki",
      descripcion: "Probá algo diferente",
      precio: "$400",
      imagen: "./assets/img/papas_dulce.jpg",
    },
    {
      id: 17,
      nombre: "Papas Curly",
      category: "Napapuki",
      descripcion: "Papa con rulo",
      precio: "$350",
      imagen: "./assets/img/papas_curly.jpg",
    },
    {
      id: 18,
      nombre: "Papas Poutine",
      category: "Napapuki",
      descripcion: "Con queso derretido y salsa grevy",
      precio: "$460",
      imagen: "./assets/img/papas_poutine.webp",
    },
    {
      id: 19,
      nombre: "Papas Picante",
      category: "Napapuki",
      descripcion: "Picoso",
      precio: "$410",
      imagen: "https://th.bing.com/th/id/R.e8eb0a12ca91c54db4b99c05fd9d557c?rik=08yTqlSicQLSPQ&pid=ImgRaw&r=0",
    },
    {
      id: 20,
      nombre: "La MR. Pit (Individual)",
      category: "Individuales",
      descripcion: "Sólo para expertos",
      precio: "$44",
      imagen: "./assets/img/Photo Menu.png",
    },
    {
      id: 21,
      nombre: "¡Q'Jamone! (Individual)",
      category: "Individuales",
      descripcion: "c/jamón crudo",
      precio: "$44",
      imagen: "./assets/img/Photo Menu-1.png",
    },
    {
      id: 22,
      nombre: "La Charly García (Individual)",
      category: "Individuales",
      descripcion: "¡BASTA!",
      precio: "$48",
      imagen: "./assets/img/Photo Menu-2.png",
    },
    {
      id: 23,
      nombre: "La Maradona (Individual)",
      category: "Individuales",
      descripcion: "¡Eterna!",
      precio: "$57",
      imagen: "./assets/img/Photo Menu-3.png",
    },
    {
      id: 24,
      nombre: "Picantovich (Individual)",
      category: "Individuales",
      descripcion: "Pica 2 veces",
      precio: "$94",
      imagen: "./assets/img/Photo Menu-4.png",
    },
    {
      id: 25,
      nombre: "La Hasbulla (Individual)",
      category: "Individuales",
      descripcion: "En honor al 1",
      precio: "$124",
      imagen: "./assets/img/Photo Menu-5.png",
    },
    {
      id: 26,
      nombre: "Leo Messi (Individual)",
      category: "Individuales",
      descripcion: "¡De pie señores!",
      precio: "$2",
      imagen: "./assets/img/Photo Menu-6.png",
    },
    {
      id: 27,
      nombre: "Nick Gi (Individual)",
      category: "Individuales",
      descripcion: "La que desaparece",
      precio: "$Gratis",
      imagen: "./assets/img/Photo Menu-7.png",
    },
    {
      id: 28,
      nombre: "Bennazianna (Individual)",
      category: "Individuales",
      descripcion: "La más completa",
      precio: "$457",
      imagen: "./assets/img/pizza_bennaziana.jpg",
    },
    {
      id: 29,
      nombre: "Tronco-Pizza (Individual)",
      category: "Individuales",
      descripcion: "Para todo el día",
      precio: "$109",
      imagen: "./assets/img/pizza_tronco.jpg",
    },
    {
      id: 30,
      nombre: "Wrap Jamón y Queso",
      category: "Wraps",
      descripcion: "Soy el wrap 1",
      precio: "$200",
      imagen: "./assets/img/wrap_jamon.jpg",
    },
    {
      id: 31,
      nombre: "Wrap Pollo",
      category: "Wraps",
      descripcion: "Soy el wrap 2",
      precio: "$250",
      imagen: "./assets/img/wrap_pollo.jpg",
    },
    {
      id: 32,
      nombre: "Wrap Pulled Pork",
      category: "Wraps",
      descripcion: "Soy el wrap 3",
      precio: "$350",
      imagen: "./assets/img/wrap_pork.jpg",
    },
    {
      id: 33,
      nombre: "Tacos",
      category: "Mexican",
      descripcion: "Te sentirás en México D.C.",
      precio: "$600",
      imagen: "./assets/img/mexican_tacos.jpg",
    },
    {
      id: 34,
      nombre: "Enchiladas",
      category: "Mexican",
      descripcion: "Se te hace agua la boca",
      precio: "$450",
      imagen: "./assets/img/mexican_enchiladas.jpg",
    },
    {
      id: 35,
      nombre: "Pozole",
      category: "Mexican",
      descripcion: "Especial para los días de invierno",
      precio: "$350",
      imagen: "./assets/img/mexican_pozole.jpg",
    },
    {
      id: 36,
      nombre: "Quesadilla",
      category: "Mexican",
      descripcion: "Un manjar que debes probar",
      precio: "$250",
      imagen: "./assets/img/mexican_quesadilla.jpg",
    },
    {
      id: 37,
      nombre: "Totopos",
      category: "Mexican",
      descripcion: "Para cualquier momento del día",
      precio: "$300",
      imagen: "./assets/img/mexican_totopos.jpg",
    },
    {
      id: 38,
      nombre: "Increible Hulk",
      category: "Batidukis",
      descripcion: "Puras cosas verdes",
      precio: "$300",
      imagen: "./assets/img/batido_hulk.jpg",
    },
    {
      id: 39,
      nombre: "Airon Man",
      category: "Batidukis",
      descripcion: "Todo el power",
      precio: "$320",
      imagen: "./assets/img/batido_iron.jpg",
    },
    {
      id: 40,
      nombre: "Homero",
      category: "Batidukis",
      descripcion: "Babosos!",
      precio: "$310",
      imagen: "./assets/img/batido_homero.jpg",
    },
  ]
};

localStorage.setItem("products", JSON.stringify(products.data)); // lo envío al local storage

const $productCard = document.querySelector(".products-cards");
const $productPopular = document.querySelector(".products-popular");
const $buttons = document.querySelectorAll(".button-value");
// al cargar la página, quiero que se renderice el HTML de todas las pizzas
window.addEventListener("load", () => pintarHTML());

function pintarHTML() {
  $productPopular.innerHTML = popular.data.map((pizza) => {
      return `
      <div class="product-card">
        <img src="${pizza.imagen}" alt="">
        <div class="product-info">
          <div class="product-top">
            <h1>${pizza.nombre}</h1>
          </div>
          <div class="product-mid">
            <p>${pizza.descripcion}</p>
          </div>
          <div class="product-after">
            <h2>${pizza.precio}</h2>
            <a href="#agregar">Agregar</a>
          </div>
        </div>
      </div>
			`;
    })
    .join("");
}


/* Filtrado de productos */
createCards();

function createCards(){
  for (let i of products.data) {
    //Creamos la Card
    let card = document.createElement("div");
    //Card tienen categorias y están ocultas inicialmente
    card.classList.add("card", i.category, "hide");
    //image div
    let imgContainer = document.createElement("div");
    imgContainer.classList.add("image-container");
    //img tag
    let image = document.createElement("img");
    image.setAttribute("src", i.imagen);
    imgContainer.appendChild(image);
    card.appendChild(imgContainer);
    //container-info
    let container = document.createElement("div");
    container.classList.add("product-info");
    //top
    let top = document.createElement("div");
    top.classList.add("product-top")
    container.appendChild(top);
    //name div
    let nameContainer = document.createElement("div");
    nameContainer.classList.add("name-container");
    top.appendChild(nameContainer);
    //nombre
    let name = document.createElement("h2");
    name.innerText = i.nombre;
    nameContainer.appendChild(name);
  
    //mid
    let mid = document.createElement("div");
    mid.classList.add("product-mid")
    container.appendChild(mid);
    //Descripcion
    let description = document.createElement("p");
    description.innerText = i.descripcion;
    mid.appendChild(description);
  
    //after
    let after = document.createElement("div");
    after.classList.add("product-after")
    container.appendChild(after);
    //Precio
    let precio = document.createElement("h2");
    precio.innerText = i.precio;
    after.appendChild(precio);
    //Boton agregar
    let agregar = document.createElement("a");
    agregar.innerText = "Agregar";
    agregar.setAttribute("href", "#agregar");
    agregar.setAttribute('marcador', i.id);
    agregar.addEventListener('click', agregarProductoAlCarrito);
    after.appendChild(agregar);
  
    card.appendChild(container);
    $productCard.appendChild(card);
  }
}
//Parametro pasado del boton (categoria)
function filterProduct(value) {
  let $texto = document.querySelectorAll(".category-tittle");
  $texto.forEach((button) =>{
    if (value.toUpperCase() == button.innerText.toUpperCase()) {
      button.classList.add("active");
    } else {
      button.classList.remove("active");
    }
    console.log(button.innerHTML);
  })
  $buttons.forEach((button) => {
    //Comprobamos si el valor del parametro es igual a lo que tiene el boton en su innerText.
    if (value.toUpperCase() == button.innerText.toUpperCase()) {
      button.classList.add("active");
    } else {
      button.classList.remove("active");
    }
    // console.log(button.innerHTML);
  });

  //Seleccionamos todas las cards
  let $elements = document.querySelectorAll(".card");
  //loop a través de las cards
  $elements.forEach((element) => {
    //Para mostrar todos los productos
    if (value == "all") {
      element.classList.remove("hide");
    } else {
      //Comprobamos si el elemento contiene la categoría pasada por parametro
      if (element.classList.contains(value)) {
        //Mostramos los elementos que tengan esa categoría
        element.classList.remove("hide");
      } else {
        //Escondemos los otros elementos
        element.classList.add("hide");
      }
    }
  });
}

//Mostrar los productos inicialmente
window.onload = () => {
  filterProduct("");
};

//Carrito
let carrito = [];
const DOMitems = document.querySelector('#items');
const $carrito = document.querySelector('#carrito');
const DOMtotal = document.querySelector('#total');
const DOMbotonVaciar = document.querySelector('#boton-vaciar');
const miLocalStorage = window.localStorage;

function agregarProductoAlCarrito(e) {
  // Añadimos el Nodo a nuestro carrito
  e.preventDefault();
  carrito.push(e.target.getAttribute('marcador'));
  renderizarCarrito();
}

function renderizarCarrito() {
  // Vaciamos todo el html
  $carrito.textContent = '';
  // Quitamos los duplicados
  const carritoSinDuplicados = [...new Set(carrito)];
  // Generamos los Nodos a partir de carrito
  carritoSinDuplicados.forEach((item) => {
      // Obtenemos el item que necesitamos de la variable base de datos
      const miItem = products.data.filter((itemProducts) => {
          // ¿Coincide las id? Solo puede existir un caso
          return itemProducts.id === parseInt(item);
      });
      // Cuenta el número de veces que se repite el producto
      const numeroUnidadesItem = carrito.reduce((total, itemId) => {
          // ¿Coincide las id? Incremento el contador, en caso contrario no mantengo
          return itemId === item ? total += 1 : total;
      }, 0);
      // Creamos el nodo del item del carrito
      const miNodo = document.createElement('li');
      miNodo.classList.add('list-group-item', 'text-right', 'mx-2');
      miNodo.textContent = `<img src="${miItem[0].imagen}" alt=""> ${miItem[0].nombre} ${miItem[0].descripcion} Cantidad:${numeroUnidadesItem} - ${miItem[0].precio}`;
      // Boton de borrar
      const miBoton = document.createElement('button');
      miBoton.classList.add('btn', 'btn-danger', 'mx-5');
      miBoton.textContent = 'X';
      miBoton.style.marginLeft = '1rem';
      miBoton.dataset.item = item;
      // miBoton.addEventListener('click', borrarItemCarrito);
      // Mezclamos nodos
      miNodo.appendChild(miBoton);
      $carrito.appendChild(miNodo);
  });
  // Renderizamos el precio total en el HTML
  DOMtotal.textContent = "CalcularTotal";
}